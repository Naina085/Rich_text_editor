<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    .text-area {
      width: 100%;
      height: 400px;
      padding: 16px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      resize: none;
      font-size: 14px;
      font-family: Arial, sans-serif;
      line-height: 1.5;
      outline: none;
      transition: border-color 0.2s;
      overflow: scroll;
      position: relative;
      white-space: pre-wrap;
    }

    #listTooltip {
      width: fit-content;
    }

    #listInstructions {
      background: rgb(220, 222, 220);
      opacity: 0.7;
      color: rgb(17, 17, 17);
      padding: 8px 10px;
      border: 1px solid rgb(204, 204, 204);
      border-radius: 6px;
      font-size: 13px;
      width: 240px;
      display: none;
      box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 6px;
      position: absolute;
  top: 30px;
  left: 0;
  z-index: 10;
    }

    .info-container:hover #listInstructions {
  display: block;
}
.text-area ol,
.text-area ul {
  margin: 0;
  padding-left: 1.2em; /* Optional: Controls bullet/number spacing */
}
  </style>
</head>

<body>
  <div class="text-area" id="textArea" contenteditable="true">Start typing here...</div>
  <button class="more-option"
    style="border-right: 1px solid #e5e7eb;border: none;border-right: 1px solid #e5e7eb;height:36px;width:40px;text-align:center;border-radius: 6px;"
    id="olBtn" onclick="setTimeout(() => toggleList('ol'), 0)">ol</button>
  <button class="more-option" style="border: none;height:36px;width:40px;text-align:center; border-radius: 6px;"
    id="ulBtn" onclick="setTimeout(() => toggleList('ul'), 0)">ul</button>
  <!-- ‚ÑπÔ∏è Info Button -->
  <div class="info-container" style="position: relative; display: inline-block;">
    <!-- ‚ÑπÔ∏è Info Button -->
    <button id="listInfoBtn"
      style="border: none; height: 36px; width: 40px; text-align: center; border-radius: 6px; background-color: #f3f4f6;">‚ÑπÔ∏è</button>
  </div>

  <!-- Tooltip on hover -->
  <div id="listTooltip"
    style="top: -28px; left: 0; background: #111; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 12px; display: none;">
    How to use nested list(Hover the Info Button)
  </div>
  <div style="display: block; position: relative;">
    <!-- Instruction box on click -->
    <div id="listInstructions">
      <strong>üìù Nested List Guide</strong><br><br>
      ‚Ä¢ <kbd>Tab</kbd> ‚Üí Indent / Nest list<br>
      ‚Ä¢ <kbd>Shift</kbd> + <kbd>Tab</kbd> ‚Üí Outdent<br>
      ‚Ä¢ <kbd>Backspace</kbd> ‚Üí Remove empty item
    </div>
  </div>
  <script>
    let currentListType = null;
    let currentListElement = null;

function toggleList(type) {
  tooltip.style.display = "none";

  const textArea = document.getElementById("textArea");
  textArea.focus();

  const selection = window.getSelection();
  if (!selection.rangeCount) return;

  const range = selection.getRangeAt(0);
  const container = range.startContainer;

  // Check if inside a list already
  let li = container;
  while (li && li.nodeName !== "LI") {
    li = li.parentNode;
  }

  let existingList = null;
  if (li) {
    existingList = li.parentNode;
  }

  // If the list is already the same type, toggle off
  if (existingList && existingList.nodeName.toLowerCase() === type) {
    const spacer = document.createElement("div");
    spacer.innerHTML = "<br>";
    spacer.setAttribute("contenteditable", "false");
    spacer.style.height = "1px";
    spacer.style.userSelect = "none";

    existingList.parentNode.insertBefore(spacer, existingList.nextSibling);

    const p = document.createElement("p");
    p.innerHTML = "<br>";
    spacer.parentNode.insertBefore(p, spacer.nextSibling);

    const newRange = document.createRange();
    newRange.setStart(p, 0);
    newRange.setEnd(p, 0);
    selection.removeAllRanges();
    selection.addRange(newRange);

    currentListType = null;
    currentListElement = null;

    document.getElementById("olBtn").style.backgroundColor = "#ffffff";
    document.getElementById("olBtn").style.color = "black";
    document.getElementById("ulBtn").style.backgroundColor = "#ffffff";
    document.getElementById("ulBtn").style.color = "black";

    return;
  }

  // If a different list exists, replace it
// If a different list exists, convert only the current <li>
if (existingList && existingList.nodeName.toLowerCase() !== type) {
  const newList = document.createElement(type);
  if (type === "ul") newList.style.listStyleType = "circle";

  existingList.insertBefore(newList, li);
  existingList.removeChild(li);
  newList.appendChild(li);

  // Reinsert the new list after the original list if it has other items
  if (existingList.nextSibling) {
    existingList.parentNode.insertBefore(newList, existingList.nextSibling);
  } else {
    existingList.parentNode.appendChild(newList);
  }

  // If original list becomes empty, remove it
  if (!existingList.hasChildNodes()) {
    existingList.remove();
  }

  currentListType = type;
  currentListElement = newList;

  const newRange = document.createRange();
  newRange.setStart(li, 0);
  newRange.setEnd(li, 0);
  selection.removeAllRanges();
  selection.addRange(newRange);
}
  else {
    // If no existing list, insert new one
    const list = document.createElement(type);
    const li = document.createElement("li");
    li.innerHTML = "<br>";
    list.appendChild(li);
    if (type === "ul") list.style.listStyleType = "circle";

    range.deleteContents();
    range.insertNode(list);

    const newRange = document.createRange();
    newRange.setStart(li, 0);
    newRange.setEnd(li, 0);
    selection.removeAllRanges();
    selection.addRange(newRange);

    currentListType = type;
    currentListElement = list;
  }

  // Update button styles
}
    document.getElementById("textArea").addEventListener("keydown", function (e) {
      const selection = window.getSelection();
      if (!selection.rangeCount) return;

      const range = selection.getRangeAt(0);
      const container = range.startContainer;

      // Find nearest li element
      let li = container;
      while (li && li.nodeName !== "LI") {
        li = li.parentNode;
      }
      if (!li) return;

      const list = li.parentNode;
      const grandParent = list.parentNode;

      // ‚úÖ Handle Backspace in empty <li>
      if (
        e.key === "Backspace" &&
        li.textContent.trim() === "" &&
        range.startOffset === 0
      ) {
        e.preventDefault();

        if (list.children.length === 1) {
          const p = document.createElement("p");
          p.innerHTML = "<br>";
          grandParent.insertBefore(p, list.nextSibling);
          list.remove();

          const newRange = document.createRange();
          newRange.setStart(p, 0);
          newRange.setEnd(p, 0);
          selection.removeAllRanges();
          selection.addRange(newRange);

        }
         else {
          const prev = li.previousElementSibling;
          list.removeChild(li);
          if (prev) {
            const newRange = document.createRange();
            newRange.selectNodeContents(prev);
            newRange.collapse(false);
            selection.removeAllRanges();
            selection.addRange(newRange);
          }
        }
      }

      // ‚úÖ Handle Tab for indentation
      if (e.key === "Tab") {
        e.preventDefault();

        const previousLi = li.previousElementSibling;
        if (e.shiftKey) {
          // Shift+Tab ‚Üí Outdent
          if (list.parentNode.nodeName === "LI") {
            const parentLi = list.parentNode;
            const parentList = parentLi.parentNode;

            parentList.insertBefore(li, parentLi.nextSibling);

            const newRange = document.createRange();
            newRange.setStart(li, 0);
            newRange.setEnd(li, 0);
            selection.removeAllRanges();
            selection.addRange(newRange);
          }
        } else {
          // Tab ‚Üí Indent
          if (previousLi) {
            let subList = previousLi.querySelector("ol, ul");
            if (!subList) {
              subList = document.createElement(list.nodeName);
              previousLi.appendChild(subList);
            }
            subList.appendChild(li);

            const newRange = document.createRange();
            newRange.setStart(li, 0);
            newRange.setEnd(li, 0);
            selection.removeAllRanges();
            selection.addRange(newRange);
          }
        }
      }
    });
    const infoBtn = document.getElementById("listInfoBtn");
    const tooltip = document.getElementById("listTooltip");
    const instructions = document.getElementById("listInstructions");

    // Hover tooltip
    document.getElementById("olBtn").addEventListener("mouseenter", () => {
      tooltip.style.display = "block";
    });
    document.getElementById("olBtn").addEventListener("mouseleave", () => {
      tooltip.style.display = "none";
    });
    document.getElementById("ulBtn").addEventListener("mouseenter", () => {
      tooltip.style.display = "block";
    });
    document.getElementById("ulBtn").addEventListener("mouseleave", () => {
      tooltip.style.display = "none";
    });

    // // Click to toggle instructions
    // infoBtn.addEventListener("mouseover", () => {

    //   // e.stopPropagation(); // So that clicking inside doesn't hide immediately
    //   instructions.style.display = "block";
    //   // instructions.style.display === "block" ? "none" : "block";
    // });

    // // Hide instructions if clicked outside
    // document.addEventListener("mouseleave", () => {
    //   // if (!infoBtn.contains(e.target)) {
    //   instructions.style.display = "none";
    //   // }
    // });
    document.addEventListener("selectionchange", () => {
  const selection = window.getSelection();
  if (!selection.rangeCount) return;

  const range = selection.getRangeAt(0);
  let node = range.startContainer;

  // Traverse up to check if inside <li>
  while (node && node.nodeName !== "LI") {
    node = node.parentNode;
  }

  // If inside <li>, set button highlight based on list type
  if (node) {
    const parentList = node.parentNode;
    const listType = parentList.nodeName.toLowerCase();

    if (listType === "ul") {
      document.getElementById("ulBtn").style.backgroundColor = "#3b82f6";
      document.getElementById("ulBtn").style.color = "white";
      document.getElementById("olBtn").style.backgroundColor = "#ffffff";
      document.getElementById("olBtn").style.color = "black";
    } else if (listType === "ol") {
      document.getElementById("olBtn").style.backgroundColor = "#3b82f6";
      document.getElementById("olBtn").style.color = "white";
      document.getElementById("ulBtn").style.backgroundColor = "#ffffff";
      document.getElementById("ulBtn").style.color = "black";
    }
  } else {
    // Not inside any <li> ‚Üí reset button styles
    document.getElementById("olBtn").style.backgroundColor = "#ffffff";
    document.getElementById("olBtn").style.color = "black";
    document.getElementById("ulBtn").style.backgroundColor = "#ffffff";
    document.getElementById("ulBtn").style.color = "black";
  }
});

  </script>
</body>

</html>